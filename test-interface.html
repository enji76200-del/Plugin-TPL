<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Slot Booking Plugin Test</title>
    <link rel="stylesheet" href="assets/css/time-slot-booking.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f6f8fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #24292f;
            text-align: center;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Plugin de Réservation de Créneaux Horaires - Test</h1>
        
        <!-- Plugin Interface -->
        <div id="tsb-booking-container" data-current-planning="1">
            
            <!-- Planning Selection -->
            <div class="tsb-planning-controls">
                <div class="tsb-planning-navigation">
                    <button id="tsb-prev-planning" class="tsb-nav-btn">&larr;</button>
                    <div class="tsb-planning-selector">
                        <select id="tsb-planning-select" class="tsb-planning-select">
                            <option value="1">Gare-Станция</option>
                            <option value="2">Centre ville Центр города</option>
                            <option value="3">Citadelle Цитадель</option>
                            <option value="4">Marché Nord Маркет Север</option>
                        </select>
                    </div>
                    <button id="tsb-next-planning" class="tsb-nav-btn">&rarr;</button>
                </div>
            </div>
            
            <div class="tsb-view-controls">
                <div class="tsb-view-toggle">
                    <button class="tsb-view-btn active" data-view="daily">Vue journalière</button>
                    <button class="tsb-view-btn" data-view="weekly">Vue hebdomadaire</button>
                </div>
                
                <div class="tsb-date-navigation">
                    <button id="tsb-prev-date" class="tsb-nav-btn">&larr;</button>
                    <span id="tsb-current-date">Chargement...</span>
                    <button id="tsb-next-date" class="tsb-nav-btn">&rarr;</button>
                </div>
            </div>
            
            <!-- Admin controls (visible for testing) -->
            <div class="tsb-admin-controls">
                <!-- Boutons admin masqués pour les utilisateurs classiques -->
            </div>
            
            <!-- Daily View -->
            <div id="tsb-daily-view" class="tsb-daily-view">
                <div id="tsb-booking-table">
                    <table class="tsb-table">
                        <thead>
                            <tr>
                                <th class="tsb-th">Horaires</th>
                                <th class="tsb-th">Créneaux</th>
                            </tr>
                        </thead>
                        <tbody id="tsb-table-body">
                            <!-- Sample data for testing -->
                            <tr>
                                <td class="tsb-time-cell" data-label="Horaires">09:00 - 10:00</td>
                                <td class="tsb-slot-cell" data-label="Créneaux">
                                    <div class="tsb-slots-container">
                                        <div class="tsb-slot-item tsb-slot-available" data-slot-id="1">
                                            <div class="tsb-slot-info">
                                                <div class="tsb-slot-status">Disponible</div>
                                                <div class="tsb-slot-capacity">2/5 inscrit(s)</div>
                                                <div class="tsb-slot-users">Inscrits : <span>Marie Dupont, Jean Martin</span></div>
                                            </div>
                                            <div class="tsb-slot-actions">
                                                <button class="tsb-btn tsb-btn-success tsb-btn-small tsb-register-btn" data-slot-id="1">S'inscrire</button>
                                                <button class="tsb-btn tsb-btn-warning tsb-btn-small tsb-unregister-btn" data-slot-id="1">Me désinscrire</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="tsb-time-cell" data-label="Horaires">10:00 - 11:00</td>
                                <td class="tsb-slot-cell" data-label="Créneaux">
                                    <div class="tsb-slots-container">
                                        <div class="tsb-slot-item tsb-slot-full" data-slot-id="2">
                                            <div class="tsb-slot-info">
                                                <div class="tsb-slot-status">Complet</div>
                                                <div class="tsb-slot-capacity">3/3 inscrit(s)</div>
                                                <div class="tsb-slot-users">Inscrits : <span>Paul Durand, Alice Petit, Hugo Leroy</span></div>
                                            </div>
                                            <div class="tsb-slot-actions">
                                                <button class="tsb-btn tsb-btn-warning tsb-btn-small tsb-unregister-btn" data-slot-id="2">Me désinscrire</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="tsb-time-cell" data-label="Horaires">14:00 - 15:00</td>
                                <td class="tsb-slot-cell" data-label="Créneaux">
                                    <div class="tsb-slots-container">
                                        <div class="tsb-slot-item tsb-slot-available" data-slot-id="3">
                                            <div class="tsb-slot-info">
                                                <div class="tsb-slot-status">Disponible</div>
                                                <div class="tsb-slot-capacity">0/4 inscrit(s)</div>
                                                <div class="tsb-slot-users">Inscrits : <span>Aucun</span></div>
                                            </div>
                                            <div class="tsb-slot-actions">
                                                <button class="tsb-btn tsb-btn-success tsb-btn-small tsb-register-btn" data-slot-id="3">S'inscrire</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="tsb-time-cell" data-label="Horaires">16:00 - 17:00</td>
                                <td class="tsb-slot-cell" data-label="Créneaux">
                                    <div class="tsb-slots-container">
                                        <div class="tsb-slot-item tsb-slot-blocked" data-slot-id="4">
                                            <div class="tsb-slot-info">
                                                <div class="tsb-slot-status">Bloqué (Maintenance)</div>
                                                <div class="tsb-slot-capacity">0/2 inscrit(s)</div>
                                                <div class="tsb-slot-users">Inscrits : <span>Aucun</span></div>
                                            </div>
                                            <div class="tsb-slot-actions">
                                                <!-- Aucun bouton pour non admin -->
                                                <div class="tsb-slot-users">Inscrits : <span>Marie D., Jean M.</span></div>
                                                <div class="tsb-slot-users">Inscrits : <span>Paul D., Alice P., Hugo L.</span></div>
                                                <div class="tsb-slot-users">Inscrits : <span>Aucun</span></div>
                                                <div class="tsb-slot-users">Inscrits : <span>Aucun</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Weekly View -->
            <div id="tsb-weekly-view" class="tsb-weekly-view" style="display: none;">
                <table class="tsb-weekly-table">
                    <thead>
                        <tr>
                            <th class="time-header">Horaires</th>
                            <th>Lundi</th>
                            <th>Mardi</th>
                            <th>Mercredi</th>
                            <th>Jeudi</th>
                            <th>Vendredi</th>
                            <th>Samedi</th>
                            <th>Dimanche</th>
                        </tr>
                    </thead>
                    <tbody id="tsb-weekly-table-body">
                        <!-- Sample weekly data for testing -->
                        <tr>
                            <td class="time-cell">09:00<br><small>10:00</small></td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-available-mini" data-slot-id="1">
                                    <div class="tsb-slot-status-mini">Libre</div>
                                    <div class="tsb-slot-capacity-mini">2/5</div>
                                    <div class="tsb-slot-users-mini">Inscrits : <span>Marie D., Jean M.</span></div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-full-mini" data-slot-id="2">
                                    <div class="tsb-slot-status-mini">Complet</div>
                                    <div class="tsb-slot-capacity-mini">3/3</div>
                                    <div class="tsb-slot-users-mini">Inscrits : <span>Paul D., Alice P., Hugo L.</span></div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-available-mini" data-slot-id="3">
                                    <div class="tsb-slot-status-mini">Libre</div>
                                    <div class="tsb-slot-capacity-mini">1/4</div>
                                    <div class="tsb-slot-users-mini">Inscrits : <span>Aucun</span></div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-blocked-mini" data-slot-id="4">
                                    <div class="tsb-slot-status-mini">Bloqué</div>
                                    <div class="tsb-slot-capacity-mini">0/2</div>
                                    <div class="tsb-slot-users-mini">Inscrits : <span>Aucun</span></div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot"></td>
                        </tr>
                        <tr>
                            <td class="time-cell">14:00<br><small>15:00</small></td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-available-mini" data-slot-id="5">
                                    <div class="tsb-slot-status-mini">Libre</div>
                                    <div class="tsb-slot-capacity-mini">0/3</div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot">
                                <div class="tsb-slot-item-mini tsb-slot-available-mini" data-slot-id="6">
                                    <div class="tsb-slot-status-mini">Libre</div>
                                    <div class="tsb-slot-capacity-mini">1/2</div>
                                </div>
                            </td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot"></td>
                            <td class="tsb-weekly-slot"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Add Time Slot Modal -->
            <div id="tsb-add-slot-modal" class="tsb-modal" style="display: none;">
                <div class="tsb-modal-content">
                    <span class="tsb-close">&times;</span>
                    <h3>Ajouter un Créneau</h3>
                    <form id="tsb-add-slot-form">
                        <div class="tsb-form-group">
                            <label>Heure de début :</label>
                            <input type="time" id="tsb-start-time" required>
                        </div>
                        <div class="tsb-form-group">
                            <label>Heure de fin :</label>
                            <input type="time" id="tsb-end-time" required>
                        </div>
                        <div class="tsb-form-group">
                            <label>Capacité :</label>
                            <input type="number" id="tsb-capacity" min="1" value="1" required>
                        </div>
                        <button type="submit" class="tsb-btn tsb-btn-primary">Ajouter le Créneau</button>
                    </form>
                </div>
            </div>
            
            <!-- User Registration Modal -->
            <div id="tsb-register-modal" class="tsb-modal" style="display: none;">
                <div class="tsb-modal-content">
                    <span class="tsb-close">&times;</span>
                    <h3>S'inscrire au Créneau</h3>
                    <form id="tsb-register-form">
                        <input type="hidden" id="tsb-register-slot-id">
                        <div class="tsb-form-group">
                            <label>Prénom :</label>
                            <input type="text" id="tsb-user-first-name" required>
                        </div>
                        <div class="tsb-form-group">
                            <label>Nom :</label>
                            <input type="text" id="tsb-user-last-name" required>
                        </div>
                        <button type="submit" class="tsb-btn tsb-btn-primary">S'inscrire</button>
                    </form>
                </div>
            </div>
            
            <!-- User Unregistration Modal -->
            <div id="tsb-unregister-modal" class="tsb-modal" style="display: none;">
                <div class="tsb-modal-content">
                    <span class="tsb-close">&times;</span>
                    <h3>Se désinscrire du créneau</h3>
                    <form id="tsb-unregister-form">
                        <input type="hidden" id="tsb-unregister-slot-id">
                        <button type="submit" class="tsb-btn tsb-btn-danger">Me désinscrire</button>
                    </form>
                </div>
            </div>
            
            <!-- Block Slot Modal -->
            <div id="tsb-block-slot-modal" class="tsb-modal" style="display: none;">
                <div class="tsb-modal-content">
                    <span class="tsb-close">&times;</span>
                    <h3>Bloquer/Débloquer le créneau</h3>
                    <form id="tsb-block-slot-form">
                        <input type="hidden" id="tsb-block-slot-id">
                        <input type="hidden" id="tsb-block-action">
                        <div class="tsb-form-group">
                            <label>
                                <input type="checkbox" id="tsb-block-checkbox"> 
                                Bloquer ce créneau
                            </label>
                        </div>
                        <div class="tsb-form-group" id="tsb-block-reason-group">
                            <label>Raison du blocage :</label>
                            <input type="text" id="tsb-block-reason" placeholder="Ex: Maintenance, Congés, etc.">
                        </div>
                        <button type="submit" class="tsb-btn tsb-btn-warning">Appliquer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize without jQuery
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date display
            const currentDate = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('tsb-current-date').textContent = currentDate.toLocaleDateString('fr-FR', options);
            
            // View switching functionality
            let currentView = 'daily';
            
            function switchView(view) {
                currentView = view;
                
                // Update active button
                document.querySelectorAll('.tsb-view-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-view="${view}"]`).classList.add('active');
                
                // Show/hide appropriate views
                if (view === 'weekly') {
                    document.getElementById('tsb-daily-view').style.display = 'none';
                    document.getElementById('tsb-weekly-view').style.display = 'block';
                    updateDateDisplayForWeekly();
                } else {
                    document.getElementById('tsb-weekly-view').style.display = 'none';
                    document.getElementById('tsb-daily-view').style.display = 'block';
                    updateDateDisplayForDaily();
                }
            }
            
            function updateDateDisplayForDaily() {
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                document.getElementById('tsb-current-date').textContent = currentDate.toLocaleDateString('fr-FR', options);
            }
            
            function updateDateDisplayForWeekly() {
                const weekStart = new Date(currentDate);
                const day = weekStart.getDay();
                const diff = weekStart.getDate() - day + (day === 0 ? -6 : 1); // Adjust for Monday start
                weekStart.setDate(diff);
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);
                
                const startStr = weekStart.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                const endStr = weekEnd.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' });
                
                document.getElementById('tsb-current-date').textContent = `Semaine du ${startStr} au ${endStr}`;
            }
            
            // Add event listeners for view buttons
            document.querySelectorAll('.tsb-view-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const view = this.getAttribute('data-view');
                    switchView(view);
                });
            });
            
            // Planning navigation
            document.getElementById('tsb-planning-select').addEventListener('change', function() {
                const selectedPlanning = this.options[this.selectedIndex].text;
                console.log('Planning sélectionné:', selectedPlanning);
            });
            
            document.getElementById('tsb-prev-planning').addEventListener('click', function() {
                const select = document.getElementById('tsb-planning-select');
                const currentIndex = select.selectedIndex;
                const newIndex = currentIndex > 0 ? currentIndex - 1 : select.options.length - 1;
                select.selectedIndex = newIndex;
                select.dispatchEvent(new Event('change'));
            });
            
            document.getElementById('tsb-next-planning').addEventListener('click', function() {
                const select = document.getElementById('tsb-planning-select');
                const currentIndex = select.selectedIndex;
                const newIndex = currentIndex < select.options.length - 1 ? currentIndex + 1 : 0;
                select.selectedIndex = newIndex;
                select.dispatchEvent(new Event('change'));
            });
            
            // Modal functionality
            function hideAllModals() {
                document.querySelectorAll('.tsb-modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
            
            // Close buttons
            document.querySelectorAll('.tsb-close').forEach(button => {
                button.addEventListener('click', hideAllModals);
            });
            
            // Add slot button
            document.getElementById('tsb-add-slot-btn').addEventListener('click', function() {
                document.getElementById('tsb-add-slot-modal').style.display = 'block';
            });
            
            // Generate weekly slots button
            document.getElementById('tsb-generate-weekly-btn').addEventListener('click', function() {
                const currentPlanning = document.getElementById('tsb-planning-select').options[document.getElementById('tsb-planning-select').selectedIndex].text;
                if (confirm(`Générer les créneaux de la semaine type pour le planning "${currentPlanning}" ? (mode test)`)) {
                    alert(`Créneaux générés pour ${currentPlanning} ! (mode test)`);
                }
            });
            
            // Register buttons
            document.querySelectorAll('.tsb-register-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const slotId = this.getAttribute('data-slot-id');
                    document.getElementById('tsb-register-slot-id').value = slotId;
                    document.getElementById('tsb-register-modal').style.display = 'block';
                });
            });
            
            // Unregister buttons
            document.querySelectorAll('.tsb-unregister-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const slotId = this.getAttribute('data-slot-id');
                    document.getElementById('tsb-unregister-slot-id').value = slotId;
                    document.getElementById('tsb-unregister-modal').style.display = 'block';
                });
            });
            
            // Block buttons
            document.querySelectorAll('.tsb-block-btn, .tsb-unblock-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const slotId = this.getAttribute('data-slot-id');
                    const isCurrentlyBlocked = this.classList.contains('tsb-unblock-btn');
                    
                    document.getElementById('tsb-block-slot-id').value = slotId;
                    document.getElementById('tsb-block-checkbox').checked = !isCurrentlyBlocked;
                    document.getElementById('tsb-block-action').value = isCurrentlyBlocked ? 'unblock' : 'block';
                    
                    const reasonGroup = document.getElementById('tsb-block-reason-group');
                    if (isCurrentlyBlocked) {
                        reasonGroup.style.display = 'none';
                    } else {
                        reasonGroup.style.display = 'block';
                    }
                    
                    document.getElementById('tsb-block-slot-modal').style.display = 'block';
                });
            });
            
            // Block mode toggle
            document.getElementById('tsb-block-mode-btn').addEventListener('click', function() {
                const isBlockMode = this.textContent.includes('normal');
                if (isBlockMode) {
                    this.textContent = 'Mode blocage';
                    this.className = 'tsb-btn tsb-btn-warning';
                } else {
                    this.textContent = 'Mode normal';
                    this.className = 'tsb-btn tsb-btn-danger';
                }
            });
            
            // Remove buttons
            document.querySelectorAll('.tsb-remove-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (confirm('Êtes-vous sûr de vouloir supprimer ce créneau ?')) {
                        const slotItem = this.closest('.tsb-slot-item');
                        slotItem.style.transition = 'opacity 0.3s';
                        slotItem.style.opacity = '0';
                        setTimeout(() => {
                            slotItem.remove();
                        }, 300);
                    }
                });
            });
            
            // Form submissions
            document.getElementById('tsb-add-slot-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Nouveau créneau ajouté ! (mode test)');
                hideAllModals();
                this.reset();
            });
            
            document.getElementById('tsb-register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Inscription réussie ! (mode test)');
                hideAllModals();
                this.reset();
            });
            
            document.getElementById('tsb-unregister-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Désinscription réussie ! (mode test)');
                hideAllModals();
                this.reset();
            });
            
            document.getElementById('tsb-block-slot-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const isBlocked = document.getElementById('tsb-block-checkbox').checked;
                const message = isBlocked ? 'Créneau bloqué !' : 'Créneau débloqué !';
                alert(message + ' (mode test)');
                hideAllModals();
                this.reset();
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('tsb-modal')) {
                    hideAllModals();
                }
            });
        });
    </script>
</body>
</html>